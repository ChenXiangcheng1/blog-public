<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Nemesis | Nemesis</title><meta name="author" content="Nemesis,chenxiangcheng1@gmail.com"><meta name="copyright" content="Nemesis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Spring Data JPAJPA(Java Persistence API) 是规范，Hibernate 实现了该规范。Spring Data JPA 依赖于 Hibernate 官方文档	|	Spring Data JPA API 文档 配置POM 1234&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;gr">
<meta property="og:type" content="article">
<meta property="og:title" content="Nemesis">
<meta property="og:url" content="https://blog.haruharu.top/articles/uncategorized/Dev/Spring/spring-data/spring_data_jpa/">
<meta property="og:site_name" content="Nemesis">
<meta property="og:description" content="Spring Data JPAJPA(Java Persistence API) 是规范，Hibernate 实现了该规范。Spring Data JPA 依赖于 Hibernate 官方文档	|	Spring Data JPA API 文档 配置POM 1234&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;gr">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-09-19T04:19:07.394Z">
<meta property="article:modified_time" content="2023-09-22T13:38:18.423Z">
<meta property="article:author" content="Nemesis">
<meta property="article:tag" content="博客,ACM,技术,开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.haruharu.top/articles/uncategorized/Dev/Spring/spring-data/spring_data_jpa/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nemesis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-22 21:38:18'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Nemesis"><span class="site-name">Nemesis</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-19T04:19:07.394Z" title="发表于 2023-09-19 12:19:07">2023-09-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-22T13:38:18.423Z" title="更新于 2023-09-22 21:38:18">2023-09-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data JPA</h1><p>JPA(Java Persistence API) 是规范，Hibernate 实现了该规范。Spring Data JPA 依赖于 Hibernate</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-jpa">官方文档</a>	|	<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/">Spring Data JPA API 文档</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application-{profile}.yml</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">datasource</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">jdbc:mysql://localhost:3307/sleeve?characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">root</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name</span>: <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jpa</span>:    <span class="string"></span></span><br><span class="line">	<span class="attr">hibernate</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">ddl-auto</span>: <span class="string">update  # DDL模式，Data Definition Language</span></span><br><span class="line"><span class="comment"># DDL模式定义了Hibernate在启动时如何处理数据库和表的结构，可以自动创建、更新、验证</span></span><br><span class="line"><span class="comment"># 默认情况，使用嵌入式数据库且无schema manager则为create-drop，否则为None</span></span><br><span class="line"><span class="comment"># validate - 每次加载hibernate时，验证创建数据库表结构，只会和数据库中的表进行比较，不会创建新表，但是会插入新值。(推荐)</span></span><br><span class="line"><span class="comment"># update - 每次加载hibernate时，执行必要的修改操作使数据库表与实体类的定义保持一致，它不会删除数据库已存在但实体类中未定义的列或表(最常用的，实体与数据库同一字段类型不一致则可能导致数据丢失)</span></span><br><span class="line"><span class="comment"># none - 不执行任何操作</span></span><br><span class="line"><span class="comment"># create-drop：每次加载hibernate时，根据model类生成表，但是sessionFactory一关闭,表就自动删除。(没用)</span></span><br><span class="line"><span class="comment"># create - 每次加载hibernate时，删除现有的数据库表(如果存在)，然后重新创建它们。这将导致数据丢失。(没用)</span></span><br><span class="line">	<span class="attr">show_sql</span>: <span class="string">true</span></span><br><span class="line">	<span class="attr">properties</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">hibernate</span>:        <span class="string"></span></span><br><span class="line">        <span class="attr">format_sql</span>: <span class="string">true</span></span><br></pre></td></tr></table></figure>



<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>领域模型(Domain Model)</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>元注解@Target</th>
<th>释义</th>
<th>成员变量</th>
</tr>
</thead>
<tbody><tr>
<td>@Entity</td>
<td>修饰实体类</td>
<td>修饰class，用来标识了该类是一个持久化的实体，会把成员变量持久化到数据库<br />修饰方法，把该方法返回的对象注册到IOC容器中<br /><br />如果你要用到第三方类库里面某个方法的时候，你就只能用@Bean把这个方法的对象注册到spring容器，因为用@Component你需要配置组件扫描到这个第三方类路径而且还要在别人源代码加上这个注解，很明显是不现实的。<br /><br />除了关联属性外，只能使用基础类型和数据的字段进行映射<br /><br />@Entity 注解的类的成员变量需要与数据库字段相对应，当数据库中存储的是JSON数据时，类成员变量使用对象会报错，可以使用String，或采取别的方式解决</td>
<td></td>
</tr>
<tr>
<td>@Table(name &#x3D; “banner1”)</td>
<td>修饰实体类</td>
<td>修饰entity类，改表名。如Order是JPA关键字<br />所以要使用<code>@Table(name = &quot;</code>Order<code>&quot;)</code></td>
<td></td>
</tr>
<tr>
<td>@Id</td>
<td>修饰成员变量</td>
<td>import javax.persistence.Id;<br />用来标识成员变量对应对应数据库表中的主键</td>
<td></td>
</tr>
<tr>
<td>@Column(length &#x3D; 16)</td>
<td>修饰成员变量</td>
<td>修饰成员变量，改字段长度</td>
<td></td>
</tr>
<tr>
<td>@Transient</td>
<td>修饰成员变量</td>
<td>暂时的，不持久化到数据库</td>
<td></td>
</tr>
<tr>
<td>@GeneratedValue(strategy&#x3D;GenerationType.xxx)</td>
<td>修饰成员变量</td>
<td>生成值的策略：<br /><strong>AUTO</strong> (默认)：值由程序控制，会多创建一个表<br /><strong>SEQUENCE</strong>：根据底层数据库的序列来生成主键，条件是数据库支持序列。<br /><strong>IDENTITY</strong>：自增<br /><strong>TABLE</strong>：使用一个特定的数据库表格来保存主键。</td>
<td></td>
</tr>
<tr>
<td>@JsonIgnore</td>
<td>修饰成员变量</td>
<td>不序列化该字段，即不会在请求中返回该字段</td>
<td></td>
</tr>
</tbody></table>
<h4 id="审查"><a href="#审查" class="headerlink" title="审查"></a>审查</h4><table>
<thead>
<tr>
<th>注解</th>
<th>元注解@Target</th>
<th>释义</th>
<th>成员变量</th>
</tr>
</thead>
<tbody><tr>
<td><code>@EnableJpaAuditing</code></td>
<td>Type</td>
<td>启动 JPA 审查，提供以下注解的支持</td>
<td></td>
</tr>
<tr>
<td>@CreatedDate</td>
<td></td>
<td>声明该字段为创建时间字段。在这个实体被insert的时候，会设置值</td>
<td></td>
</tr>
<tr>
<td>@CreatedBy</td>
<td></td>
<td>声明该字段为创建人。在这个实体被insert的时候，会设置值</td>
<td></td>
</tr>
<tr>
<td>@LastModifiedDate</td>
<td></td>
<td>最后修改时间 实体被update的时候会设置</td>
<td></td>
</tr>
<tr>
<td>@LastModifiedBy</td>
<td></td>
<td>最后修改人 实体被update的时候会设置</td>
<td></td>
</tr>
</tbody></table>
<h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><table>
<thead>
<tr>
<th>注解</th>
<th>元注解@Target</th>
<th>释义</th>
<th>成员变量</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Bean层</strong></td>
<td></td>
<td><strong>修饰表明表间关系的导航属性（成员变量）</strong></td>
<td></td>
</tr>
<tr>
<td>单向一对多：正向 (一到多)需要导航关系</td>
<td></td>
<td>双向一对多：正向反向都需要导航关系</td>
<td></td>
</tr>
<tr>
<td>@OneToMany(mappedBy &#x3D; “banner”,fetch &#x3D; FetchType.LAZY)</td>
<td></td>
<td>修饰<strong>导航属性</strong>，不使用@JoinColumn指明外键会创建第三张表存储关系，该注解用于实现关联查询<br /><br />fetch属性：LAZY (<strong>懒加载</strong>默认)，在使用该导航属性时才执行关联查询，用于节约SQL性能<br />为配合LAZY，Controller返回的应是VO对象<br />EAGER (<strong>急加载</strong>)<br /><br />mappedBy属性：指向<strong>关系的维护端</strong> (多端)的导航属性<br />关联查询查导航属性name</td>
<td></td>
</tr>
<tr>
<td>@JoinColumn(foreignKey &#x3D; @ForeignKey(value &#x3D; ConstraintMode.NO_CONSTRAINT), insertable &#x3D; false, updatable &#x3D; false, name &#x3D; “bannerId”)</td>
<td></td>
<td>修饰<strong>导航属性</strong>，name属性<strong>指向外键</strong>，会在数据库中创建外键字段<br />在<strong>单向一对多关系</strong>中，修饰一端 (关系的被维护端)，外键在多端的表上。需要在一端创建导航属性，在多端创建外键字段bannerId。<br />在<strong>双向一对多关系</strong>中，修饰多端 (关系的维护端)，外键在多端的表上。需要在一端创建导航属性，在多端创建导航属性，不需要在多端创建外键属性bannerId (如果想有外键属性可以加上insertalbe&#x2F;updatable属性)（双向一对多也可以不使用该注解，也会自动创建外键）</td>
<td></td>
</tr>
<tr>
<td>@org.hibernate.annotations.ForeignKey(name &#x3D; “null”)</td>
<td></td>
<td>修饰导航属性，禁止物理外键生成，用逻辑外键，落伍的方式</td>
<td></td>
</tr>
<tr>
<td>@ManyToOne</td>
<td></td>
<td>修饰<strong>导航属性</strong>，配合@OneToMany使用，实现双向一对多关系</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>@ManyToMany(mappedBy &#x3D; “spuList”)</td>
<td></td>
<td>表示多对多关系，会创建第三张表存储关系<br /><br />mappedBy属性：指向<strong>关系的维护端</strong> (多端)的导航属性</td>
<td></td>
</tr>
<tr>
<td>@JoinTable(name &#x3D; “theme_spu”, joinColumns &#x3D; @JoinColumn(name &#x3D; “theme_id”),        inverseJoinColumns &#x3D; @JoinColumn(name &#x3D; “spu_id”))</td>
<td></td>
<td>设置第三张表（theme_spu）命名规范<br />外键字段、反转外键字段</td>
<td></td>
</tr>
</tbody></table>
<h3 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h3><p>Repository 持久层</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>元注解@Target</th>
<th>释义</th>
<th>成员变量</th>
</tr>
</thead>
<tbody><tr>
<td>@Query(value &#x3D; “”, nativeQuery &#x3D; false)</td>
<td></td>
<td>创建查询，编写JPQL语句，并通过类似 “:name” 来映射@Param指定的参数，就像例子中的第三个findUser函数一样。<br />nativeQuery 参数表示使用原生native SQL还是JPQL(Java Persistence Query Language)<br />例子：@Query(“select t from Theme t where t.name in (:names)”)<br />这里 Theme t ，类似于 sql 里的 as ，把实体简写成一个字母，这里是把Theme简写成t</td>
<td></td>
</tr>
<tr>
<td>@Param</td>
<td></td>
<td>例子：User getUser(@Param(“userId”)String userId,@Param(“password”)String password);<br/>import org.springframework.data.repository.query.Param; spring的注解，参数要按照先后顺序传入<br/>import org.apache.ibatis.annotations.Param; mybatis的注解，只需要使用参数名即可，更常用</td>
<td></td>
</tr>
<tr>
<td>@Modifying</td>
<td></td>
<td>对方法使用，更新插入删除的方法</td>
<td></td>
</tr>
</tbody></table>
<h1 id="未整理"><a href="#未整理" class="headerlink" title="未整理"></a>未整理</h1><h3 id="entity-实体层"><a href="#entity-实体层" class="headerlink" title="entity 实体层"></a>entity 实体层</h3><p>必须使用 @Entity 和 @Id 注解</p>
<h4 id="IDEA-实体导出"><a href="#IDEA-实体导出" class="headerlink" title="IDEA 实体导出"></a>IDEA 实体导出</h4><p>从数据库导出实体类</p>
<p><img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_19_12_22.png"></p>
<h4 id="双向一对多"><a href="#双向一对多" class="headerlink" title="双向一对多"></a>双向一对多</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.model_discard;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/4 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;banner&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Banner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(length = 16)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String img;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;banner&quot;, fetch = FetchType.EAGER)</span></span><br><span class="line"><span class="comment">//    @JoinColumn(name = &quot;bannerId&quot;)</span></span><br><span class="line"><span class="comment">//    @org.hibernate.annotations.ForeignKey(name = &quot;null&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;BannerItem&gt; items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.model_discard;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/5 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BannerItem</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String img;</span><br><span class="line">    <span class="keyword">private</span> String keyword;</span><br><span class="line">    <span class="keyword">private</span> Short type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long bannerId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(foreignKey = @ForeignKey(value = ConstraintMode.NO_CONSTRAINT), insertable = false, updatable = false, name = &quot;bannerId&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Banner banner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="双向多对多"><a href="#双向多对多" class="headerlink" title="双向多对多"></a>双向多对多</h4><p>小心循环序列化，造成内存泄露</p>
<p>解决循环序列化可以采用：1、使用VO 2、@JsonIgnore</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.model_discard;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/6 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Theme</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    <span class="meta">@JoinTable(name = &quot;theme_spu&quot;, joinColumns = @JoinColumn(name = &quot;theme_id&quot;),</span></span><br><span class="line"><span class="meta">            inverseJoinColumns = @JoinColumn(name = &quot;spu_id&quot;))</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Spu&gt; spuList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.model_discard;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToMany;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/6 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String subtitle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy = &quot;spuList&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Theme&gt; themeList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="VO-层"><a href="#VO-层" class="headerlink" title="VO 层"></a>VO 层</h4><p>查询出来的对象需要经过一层VO对象的封装(拷贝给VO对象)，才能再传给前端。<strong>Java项目每一层都是一次封装</strong></p>
<p>VO：value object 是从服务端返回到前端的数据对象</p>
<p>自己的项目一般直接返回model实体层的数据，因为model对应数据库中的数据不一定都是你需要的，避免多余数据的序列化，可提高查询性能 (懒加载)</p>
<p>例：</p>
<p>CategoryPureVO类：用于过滤导航属性、不要的字段、还可以避免 循环序列化</p>
<h5 id="简单封装：拷贝对象的几种方法"><a href="#简单封装：拷贝对象的几种方法" class="headerlink" title="简单封装：拷贝对象的几种方法"></a>简单封装：拷贝对象的几种方法</h5><h6 id="1、一个个get再set"><a href="#1、一个个get再set" class="headerlink" title="1、一个个get再set"></a>1、一个个get再set</h6><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpuSimplifyVO vo <span class="operator">=</span> new SpuSimplifyVO()<span class="comment">;</span></span><br><span class="line">vo.setXX(spu.getXX())<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h6 id="2、使用spring的BeanUtils-浅拷贝"><a href="#2、使用spring的BeanUtils-浅拷贝" class="headerlink" title="2、使用spring的BeanUtils 浅拷贝"></a>2、使用spring的BeanUtils 浅拷贝</h6><p>基础类型的拷贝使用 BeanUtils 足够了</p>
<p>例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line">BeanUtils.copyProperties(spu, vo);<span class="keyword">return</span> vo;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">CategoryPureVO</span><span class="params">(Category category)</span> &#123;</span><br><span class="line">       BeanUtils.copyProperties(category, <span class="built_in">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h6 id="3、使用-DozerBeanMapper-深拷贝（dozer-推土机）"><a href="#3、使用-DozerBeanMapper-深拷贝（dozer-推土机）" class="headerlink" title="3、使用 DozerBeanMapper 深拷贝（dozer: 推土机）"></a>3、使用 DozerBeanMapper 深拷贝（dozer: 推土机）</h6><p>其优势是可以实现对象的深拷贝</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.dozermapper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dozer-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Mapper</span> <span class="variable">mapper</span> <span class="operator">=</span> DozerBeanMapperBuilder.buildDefault();		</span><br><span class="line"><span class="type">SpuSimplifyVO</span> <span class="variable">vo</span> <span class="operator">=</span> mapper.map(spu, SpuSimplifyVO.class);  <span class="comment">// 第一个参数是需要被拷贝的对象，第二个参数是拷贝后的目标对象的类型</span></span><br></pre></td></tr></table></figure>

<p>map(源对象，目标类)：深拷贝的核心方法</p>
<h5 id="泛型类的封装"><a href="#泛型类的封装" class="headerlink" title="泛型类的封装"></a>泛型类的封装</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 泛型封装，封装需要返回到前端的分页页面数据 Page&lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/29 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Paging</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer totalPage;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Paging</span><span class="params">(Page&lt;T&gt; pageT)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.initPageParameter(pageT);</span><br><span class="line">        <span class="built_in">this</span>.items = pageT.getContent();  <span class="comment">// 这里不放入initPageParameter方法中是因为，扩展Paging不需要复制这个属性</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    参数复制</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">initPageParameter</span><span class="params">(Page&lt;T&gt; pageT)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = pageT.getTotalElements();</span><br><span class="line">        <span class="built_in">this</span>.count = pageT.getSize();</span><br><span class="line">        <span class="built_in">this</span>.page = pageT.getNumber();</span><br><span class="line">        <span class="built_in">this</span>.totalPage = pageT.getTotalPages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="高级VO案例"><a href="#高级VO案例" class="headerlink" title="高级VO案例"></a>高级VO案例</h5><p><strong>静态方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.model.Coupon;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/9 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponPureVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Date startTime;</span><br><span class="line">    <span class="keyword">private</span> Date endTime;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullMoney;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal minus;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal rate;</span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">    <span class="keyword">private</span> Boolean wholeStore;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CouponPureVo</span><span class="params">(Object[] objects)</span> &#123;</span><br><span class="line">        <span class="type">Coupon</span> <span class="variable">coupon</span> <span class="operator">=</span> (Coupon) objects[<span class="number">0</span>];</span><br><span class="line">        BeanUtils.copyProperties(coupon, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CouponPureVo</span><span class="params">(Coupon coupon)</span> &#123;</span><br><span class="line">        BeanUtils.copyProperties(coupon, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;CouponPureVo&gt; <span class="title function_">getList</span><span class="params">(List&lt;Coupon&gt; couponList)</span> &#123;</span><br><span class="line">        List&lt;CouponPureVo&gt; vos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> couponList.stream()</span><br><span class="line">                .map(CouponPureVo::<span class="keyword">new</span>)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>继承净化</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.model.Activity;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/9 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityCouponVO</span> <span class="keyword">extends</span> <span class="title class_">ActivityPureVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CouponPureVo&gt; coupons;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ActivityCouponVO</span><span class="params">(Activity activity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(activity);</span><br><span class="line">        coupons = activity.getCouponList().stream()</span><br><span class="line">                .map(CouponPureVo::<span class="keyword">new</span>)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Repository-持久层"><a href="#Repository-持久层" class="headerlink" title="Repository 持久层"></a>Repository 持久层</h2><p>Repository 持久层</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html">JpaRepository 的 API 文档</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承JpaRepository&lt;Bean类, PrimarilyKey主键的类型&gt;，**自动注入容器**</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过解析方法名创建查询。</span></span><br><span class="line">    User <span class="title function_">findByNameAndAge</span><span class="params">(String name, Integer age)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;from User u where u.name=:name&quot;)</span></span><br><span class="line">    User <span class="title function_">findUser</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命名方法-JPA持久化接口"><a href="#命名方法-JPA持久化接口" class="headerlink" title="命名方法 JPA持久化接口"></a>命名方法 JPA持久化接口</h3><p>JPA接口命名规则，Jpa有词法分析器，分析方式类似普通SQL解析</p>
<table>
<thead>
<tr>
<th>JpaRepository API方法</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>基础方法</td>
<td><strong>接口中不需要实现的方法</strong></td>
</tr>
<tr>
<td>findAll()<br />findAll(Pageable page)</td>
<td>重载：就是函数或者方法有相同的名称，但是参数列表不相同的情形，这样的同名不同参数的函数或者方法之间，互相称之为重载函数或者重载方法。<br />根据分页对象，查询数据库中的数据</td>
</tr>
<tr>
<td>findOne()</td>
<td></td>
</tr>
<tr>
<td>save()</td>
<td>存储数据</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>自定义方法</td>
<td><strong>接口中需要实现的方法</strong></td>
</tr>
<tr>
<td>findOneBy成员变量OrderBy成员变量Desc(成员变量形参)</td>
<td>IDE有只能感知，JPA会自动生成SQL：select * from 表 where 成员变量 &#x3D; 参数 <br />例如：Page&lt;Spu&gt; findByCategoryId(Long cid, Pageable pageable);<br />asc升序，desc倒序</td>
</tr>
<tr>
<td><strong>常用JPA关键字</strong></td>
<td><strong>SQL关键字：</strong>or、and、like、OrderBy、&gt;、&lt;</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>复杂SQL需要自己写 JPQL&#x2F;SQL</strong></td>
<td>JPQL：Java Persistence Query Language：Java持久化查询语言，操作的是model模型，查出来的还是model模型<br />缺点：维护SQL、存储过程很麻烦</td>
</tr>
<tr>
<td>@Query(“select t from Theme t where t.name in (:names)”)</td>
<td>创建查询，编写JPQL语句，并通过类似 “:name” <strong>用冒号变量来映射@Param指定的参数</strong>，就像例子中的第三个findUser函数一样。<br />nativeQuery 参数表示使用原生native SQL还是JPQL(Java Persistence Query Language)<br />例子：@Query(“select t from Theme t where t.name in (:names)”)<br />这里 Theme t ，类似于 sql 里的 as ，把实体简写成一个字母，这里是把Theme简写成t</td>
</tr>
</tbody></table>
<h3 id="JPQL"><a href="#JPQL" class="headerlink" title="JPQL"></a>JPQL</h3><p>JPQL操作的是model，一般连表查询采用JPQL，有导航关系的连表查询也可以用命名方法查询（如，<code>findByCouponListId</code>）</p>
<p>普通多对多Join连表查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> idea JPQL Fragment中</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> coupon <span class="keyword">join</span> coupon_category <span class="keyword">on</span> coupon.id <span class="operator">=</span> coupon_category.coupon_id <span class="keyword">join</span> category <span class="keyword">on</span> coupon_category.category_id <span class="operator">=</span> category.id <span class="keyword">where</span> category.id <span class="operator">=</span> <span class="number">32</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> idea JPQL Fragment中</span><br><span class="line"><span class="keyword">select</span> c <span class="keyword">from</span> Coupon c </span><br><span class="line"><span class="keyword">join</span> </span><br><span class="line">c.categoryList ca</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">Activity a <span class="keyword">on</span> a.id <span class="operator">=</span> c.activityId</span><br><span class="line"><span class="keyword">where</span> ca.id <span class="operator">=</span> :cid</span><br><span class="line"><span class="keyword">and</span> a.startTime <span class="operator">&lt;</span> :now</span><br><span class="line"><span class="keyword">and</span> a.endTime <span class="operator">&gt;</span> :now</span><br></pre></td></tr></table></figure>

<p>如果配置了导航属性，JPQL中不用 on 关键字</p>
<h4 id="IDEA-小技巧"><a href="#IDEA-小技巧" class="headerlink" title="IDEA 小技巧"></a>IDEA 小技巧</h4><p>IDEA 可以使用Spring Data QL Fragment 分段，写 JPQL&#x2F;SQL</p>
<p><img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_19_12_21.png" alt="1620399586191"></p>
<h4 id="返回-Optional"><a href="#返回-Optional" class="headerlink" title="返回 Optional"></a>返回 Optional</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Theme findByName(String name);</span></span><br><span class="line">Optional&lt;Theme&gt; <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><p>分页逻辑：在数据库查询时分页，而不是全查询出来再分页</p>
<p>传统分页参数：Page（页码）、每页的条数（size）</p>
<p>移动端分页参数：start（从第几条开始获取数据）、count（一页获取多少条）</p>
<h4 id="分页对象Pageable"><a href="#分页对象Pageable" class="headerlink" title="分页对象Pageable"></a>分页对象Pageable</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构建JPA分页对象，参数page、size、Sort</span></span><br><span class="line"><span class="type">Pageable</span> <span class="variable">page</span> <span class="operator">=</span> PageRequest.of(pageNum, size, Sort.by(<span class="string">&quot;createTime&quot;</span>).descending());<span class="keyword">return</span> <span class="built_in">this</span>.spuRepository.findAll(page);  <span class="comment">// 返回的对象是Page&lt;T&gt;</span></span><br></pre></td></tr></table></figure>

<p>JPA操作的是Model对象，而不是我们直接操作数据库，所以参数用的不是数据库中的下划线字段，而是model中的驼峰属性</p>
<h4 id="带条件的SQL分页查询"><a href="#带条件的SQL分页查询" class="headerlink" title="带条件的SQL分页查询"></a>带条件的SQL分页查询</h4><p>Page&lt;Spu&gt; findByCategoryId(Long cid, Pageable pageable);</p>
<h3 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h3><p>去看 SpringBoot 自动配置解析笔记</p>
<h2 id="分页操作"><a href="#分页操作" class="headerlink" title="分页操作"></a>分页操作</h2><h3 id="分页参数转换"><a href="#分页参数转换" class="headerlink" title="分页参数转换"></a>分页参数转换</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.bo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bo: business object，业务对象，由service传送到controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/22 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageCounter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.bo.PageCounter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页参数转换  start、count ==&gt; pageNum、size</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/22 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 两个参数、所以封装了一下 PageCounter</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PageCounter <span class="title function_">convertToPageParameter</span><span class="params">(Integer start, Integer count)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> start / count;</span><br><span class="line">        <span class="type">PageCounter</span> <span class="variable">pageCounter</span> <span class="operator">=</span> PageCounter.builder()</span><br><span class="line">                .page(pageNum)</span><br><span class="line">                .count(count)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> pageCounter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="分页结果的封装VO"><a href="#分页结果的封装VO" class="headerlink" title="分页结果的封装VO"></a>分页结果的封装VO</h3><h4 id="分页结果Page对象的方法"><a href="#分页结果Page对象的方法" class="headerlink" title="分页结果Page&lt;T&gt;对象的方法"></a>分页结果Page&lt;T&gt;对象的方法</h4><table>
<thead>
<tr>
<th>page&lt;T&gt;</th>
<th>泛型&lt;泛型参数&gt;</th>
</tr>
</thead>
<tbody><tr>
<td>getContent()</td>
<td>每条内容的List</td>
</tr>
<tr>
<td>getTotalElements()</td>
<td>总共多少条</td>
</tr>
<tr>
<td>getSize()</td>
<td>一页多少条</td>
</tr>
<tr>
<td>getNumber()</td>
<td>当前页码</td>
</tr>
<tr>
<td>getTotalPages()</td>
<td>总页数</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="封装分页查询后的数据Page为VO-Paging"><a href="#封装分页查询后的数据Page为VO-Paging" class="headerlink" title="封装分页查询后的数据Page&lt;T&gt;为VO(Paging)"></a>封装分页查询后的数据Page&lt;T&gt;为VO(Paging)</h4><p>查询出来的对象，要经过一层VO的封装才能返回到前端</p>
<p>用泛型类提取通用的类，简化代码的编写</p>
<p>详见<strong>泛型类的封装</strong>的笔记</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 泛型封装，封装需要返回到前端的分页页面数据 Page&lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/29 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Paging</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer totalPage;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Paging</span><span class="params">(Page&lt;T&gt; pageT)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.initPageParameter(pageT);</span><br><span class="line">        <span class="built_in">this</span>.items = pageT.getContent();  <span class="comment">// 这里不放入initPageParameter方法中是因为，扩展Paging不需要复制这个属性</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    参数复制</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">initPageParameter</span><span class="params">(Page&lt;T&gt; pageT)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = pageT.getTotalElements();</span><br><span class="line">        <span class="built_in">this</span>.count = pageT.getSize();</span><br><span class="line">        <span class="built_in">this</span>.page = pageT.getNumber();</span><br><span class="line">        <span class="built_in">this</span>.totalPage = pageT.getTotalPages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配合Dozer实现扩展Page-Paging-对象（泛型类的继承）"><a href="#配合Dozer实现扩展Page-Paging-对象（泛型类的继承）" class="headerlink" title="配合Dozer实现扩展Page&lt;T&gt;(Paging)对象（泛型类的继承）"></a>配合Dozer实现扩展Page&lt;T&gt;(Paging)对象（泛型类的继承）</h4><p>将Page&lt;T&gt;结果对象封装为可以深拷贝的VO对象</p>
<p>实现可以进行属性的复制的 Page&lt;T&gt;对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.dozermapper.core.DozerBeanMapperBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.dozermapper.core.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现深拷贝的Page对象，T (model) ==&gt; K VO对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/29 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 需要两个泛型参数，T是源类型，K是目标类型。T是父类需要的泛型参数是，K是业务需要的泛型参数</span></span><br><span class="line"><span class="comment">// 构造方法参数和泛函参数是不一样的，这里的PagingDozer构造方法是需要page&lt;T&gt;对象，返回的泛函参数是T</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PagingDozer</span>&lt;T, K&gt; <span class="keyword">extends</span> <span class="title class_">Paging</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="comment">// suppress：抑制  // 该注解用于抑制没有权限访问的域的警告</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PagingDozer</span><span class="params">(Page&lt;T&gt; pageT, Class&lt;K&gt; classK)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.initPageParameter(pageT);</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; tList = pageT.getContent();</span><br><span class="line">        <span class="type">Mapper</span> <span class="variable">mapper</span> <span class="operator">=</span> DozerBeanMapperBuilder.buildDefault();</span><br><span class="line">        List&lt;K&gt; voList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        tList.forEach(t-&gt;&#123;</span><br><span class="line">            <span class="type">K</span> <span class="variable">vo</span> <span class="operator">=</span> mapper.map(t, classK);</span><br><span class="line">            voList.add(vo);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">this</span>.setItems(voList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Java泛型扩展：是一种伪泛型，从K难以拿到源类classK。而.net和C++的模板可以实现真正的泛型。为什么Java不实现呢，因为Java比较保守，为了维护以前JDK的版本</p>
<h3 id="重构过程（附Controller代码）"><a href="#重构过程（附Controller代码）" class="headerlink" title="重构过程（附Controller代码）"></a>重构过程（附Controller代码）</h3><p>抽象来源于具体</p>
<p>重构之前：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/latest?start= &amp; count=&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SpuSimplifyVO&gt; <span class="title function_">getLatestSpuList</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> Integer start,</span></span><br><span class="line"><span class="params">                                                <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer count)</span> &#123;</span><br><span class="line">        <span class="type">PageCounter</span> <span class="variable">pageCounter</span> <span class="operator">=</span> CommonUtil.convertToPageParameter(start, count);</span><br><span class="line">        <span class="comment">// 查询出来的对象，要经过一层VO的封装才能返回到前端</span></span><br><span class="line">        Page&lt;Spu&gt; spuList = <span class="built_in">this</span>.spuService.getLatestPagingSpu(pageCounter.getPage(), pageCounter.getCount());</span><br><span class="line">        <span class="type">Mapper</span> <span class="variable">mapper</span> <span class="operator">=</span> DozerBeanMapperBuilder.buildDefault();</span><br><span class="line">        List&lt;SpuSimplifyVO&gt; vos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        spuList.forEach(s-&gt;&#123;</span><br><span class="line">            <span class="type">SpuSimplifyVO</span> <span class="variable">vo</span> <span class="operator">=</span> mapper.map(s, SpuSimplifyVO.class);</span><br><span class="line">            vos.add(vo);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> vos;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>重构之后：</p>
<p>使Controller中代码更整洁，阅读效率更高</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/latest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PagingDozer&lt;Spu, SpuSimplifyVO&gt; <span class="title function_">getLatestSpuList</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> Integer start,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer count)</span> &#123;</span><br><span class="line">    <span class="type">PageCounter</span> <span class="variable">pageCounter</span> <span class="operator">=</span> CommonUtil.convertToPageParameter(start, count);</span><br><span class="line">    Page&lt;Spu&gt; page = <span class="built_in">this</span>.spuService.getLatestPagingSpu(pageCounter.getPage(), pageCounter.getCount());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PagingDozer</span>&lt;&gt;(page, SpuSimplifyVO.class);  <span class="comment">// 因为泛型参数可以从方法签名的返回中推断出来，所以这里不需要了 PagingDozer&lt;Spu, SpuSimplifyVO&gt;     </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="详解SKU的规格设计"><a href="#详解SKU的规格设计" class="headerlink" title="详解SKU的规格设计"></a>详解SKU的规格设计</h2><p>尽可能不要硬编码</p>
<p>JSR303校验的message模板配置</p>
<p>可以适当去看数据库的设计的笔记的关于电商项目数据库设计的部分</p>
<h2 id="通用泛型Converter"><a href="#通用泛型Converter" class="headerlink" title="通用泛型Converter"></a>通用泛型Converter</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>场景1：当Spring使用@Entity注解，若数据库存储JSON数据时，项目中对应model的改成员变量使用对象会报错，使用String对应Json不会。这时可使用序列化的方式<br>场景2：当调用第三方API接口时，返回JSON字符串，需要序列化为对象</p>
<p>Springboot的JPA默认序列化库是Jackson，也可以去使用阿里巴巴的FastJson</p>
<p>单体JSON对象的映射处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String specs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Spec&gt; <span class="title function_">getSpecs</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">specs</span> <span class="operator">=</span> <span class="built_in">this</span>.specs;</span><br><span class="line">    <span class="comment">// Jackson</span></span><br><span class="line">    <span class="keyword">return</span> List&lt;Spec&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSpecs</span><span class="params">(List&lt;Spec&gt; data)</span> &#123;</span><br><span class="line">    <span class="comment">// Jackson</span></span><br><span class="line">    <span class="built_in">this</span>.specs = String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>做个懒人，可以自己封装一下，使只用写一次，在任何实体里面都可以把数据库的JSON字段装化成Map的形式</p>
<h3 id="mapper序列化器方法"><a href="#mapper序列化器方法" class="headerlink" title="mapper序列化器方法"></a>mapper序列化器方法</h3><table>
<thead>
<tr>
<th>序列化器方法</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;T&gt; T readValue(String content, Class<T> valueType)</td>
<td>将JSONcontent序列化为T类型的对象</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="单体JSON到Map的映射AttributeConverter"><a href="#单体JSON到Map的映射AttributeConverter" class="headerlink" title="单体JSON到Map的映射AttributeConverter"></a>单体JSON到Map的映射AttributeConverter</h3><p>使用Jackson进行序列化操作</p>
<p>配合AttributeConverter，泛型参数为EntityAttribute实体属性类型 和 DatabaseColumn数据库类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.exception.http.ServerErrorException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.HashedMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.AttributeConverter;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Converter;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/3 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Converter</span> <span class="comment">// 该注解表示交给容器管理，当需要时自动调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapAndJson</span> <span class="keyword">implements</span> <span class="title class_">AttributeConverter</span>&lt;Map&lt;String, Object&gt;, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper mapper;  <span class="comment">// Jackson的mapper序列化器</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">convertToDatabaseColumn</span><span class="params">(Map&lt;String, Object&gt; stringObjectMap)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(stringObjectMap);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// IO异常不用全局处理，只用返回500服务器异常错误就好，因为IO异常往往是硬件或网络问题，前端不需要了解。还可以记入日志</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">convertToEntityAttribute</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.readValue(s, HashedMap.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        map只是一个接口，所以不能map.class，要具体的</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Convert(converter = MapAndJson.class)</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, Object&gt; test;</span><br></pre></td></tr></table></figure>

<p>之所以是Map的value不是强类型的而是Object类型，是因为需要工具类的通用性，但是弊端是使Map失去了类的业务能力</p>
<h3 id="数组类型JSON与List的映射"><a href="#数组类型JSON与List的映射" class="headerlink" title="数组类型JSON与List的映射"></a>数组类型JSON与List的映射</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.exception.http.ServerErrorException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.AttributeConverter;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Converter;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/3 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Converter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListAndJson</span> <span class="keyword">implements</span> <span class="title class_">AttributeConverter</span>&lt;List&lt;Object&gt;, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">convertToDatabaseColumn</span><span class="params">(List&lt;Object&gt; objects)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(objects);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">convertToEntityAttribute</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;Object&gt; t = mapper.readValue(s, List.class);</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Convert(converter = ListAndJson.class)</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;Object&gt; specs;</span><br></pre></td></tr></table></figure>

<h3 id="谈Java类的内聚性、方法外置问题"><a href="#谈Java类的内聚性、方法外置问题" class="headerlink" title="谈Java类的内聚性、方法外置问题"></a>谈Java类的内聚性、方法外置问题</h3><p>List、Map表达业务对象：缺点集合失去了业务的能力 (方法的能力)</p>
<p>如果要定义List、Map业务对象的方法，要使方法依附在对象上外置</p>
<h3 id="通用泛型类对数据库Json的序列化与反序列化"><a href="#通用泛型类对数据库Json的序列化与反序列化" class="headerlink" title="通用泛型类对数据库Json的序列化与反序列化"></a>通用泛型类对数据库Json的序列化与反序列化</h3><p>单体泛型反序列化与List泛型反序列化（两种方法签名设计）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.exception.http.ServerErrorException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic：通用的</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/5/4 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericAndJson</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMapper</span><span class="params">(ObjectMapper mapper)</span> &#123;</span><br><span class="line">        GenericAndJson.mapper = mapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String <span class="title function_">objectToJson</span><span class="params">(T o)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> GenericAndJson.mapper.writeValueAsString(o);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 单体泛型反序列化</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// 这方法失败了，返回的是ArrayList&lt;HashMap&gt;而不是ArrayList&lt;Spec&gt;</span></span><br><span class="line"><span class="comment">    public static &lt;T&gt; T jsonToObject(String s, Class&lt;T&gt; classT) &#123;</span></span><br><span class="line"><span class="comment">        if (s == null) &#123;</span></span><br><span class="line"><span class="comment">            return null;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">            T o = GenericAndJson.mapper.readValue(s, classT);</span></span><br><span class="line"><span class="comment">            return o;</span></span><br><span class="line"><span class="comment">        &#125; catch (JsonProcessingException e) &#123;</span></span><br><span class="line"><span class="comment">            e.printStackTrace();</span></span><br><span class="line"><span class="comment">            throw new ServerErrorException(9999);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">jsonToObject</span><span class="params">(String s, TypeReference&lt;T&gt; tr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">T</span> <span class="variable">o</span> <span class="operator">=</span> GenericAndJson.mapper.readValue(s, tr);</span><br><span class="line">            <span class="keyword">return</span> o;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    List泛型反序列化</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//    方法签名设计2，Spec == T</span></span><br><span class="line"><span class="comment">// 这方法失败了，返回的是ArrayList&lt;HashMap&gt;而不是ArrayList&lt;Spec&gt;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        public static &lt;T&gt; List&lt;T&gt; jsonToList(String s) &#123;</span></span><br><span class="line"><span class="comment">        if (null == s) &#123;</span></span><br><span class="line"><span class="comment">            return null;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">            List&lt;T&gt; list = GenericAndJson.mapper.readValue(s, new TypeReference&lt;List&lt;T&gt;&gt;() &#123;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">            return list;</span></span><br><span class="line"><span class="comment">        &#125; catch (JsonProcessingException e) &#123;</span></span><br><span class="line"><span class="comment">            e.printStackTrace();</span></span><br><span class="line"><span class="comment">            throw new ServerErrorException(9999);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//    方法签名设计1，List&lt;Spec&gt; == T</span></span><br><span class="line"><span class="comment">//    public static &lt;T&gt; T jsonToList(String s, Class&lt;T&gt; classT)时，classT为List&lt;Spec&gt;.class不能传参</span></span><br><span class="line"><span class="comment">//    所以使用TypeReference&lt;T&gt;，调用时构造TypeReference&lt;List&lt;Spec&gt;&gt;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">jsonToList</span><span class="params">(String s, TypeReference&lt;T&gt; tr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == s) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">T</span> <span class="variable">list</span> <span class="operator">=</span> GenericAndJson.mapper.readValue(s, tr);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerErrorException</span>(<span class="number">9999</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjbti.missyou.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.zjbti.missyou.util.GenericAndJson;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/22 <span class="doctag">@Created</span> by cxc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sku</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discountPrice;</span><br><span class="line">    <span class="keyword">private</span> Boolean online;</span><br><span class="line">    <span class="keyword">private</span> String img;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> Long rootCategoryId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String specs;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> Long stock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Spec&gt; <span class="title function_">getSpecs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == <span class="built_in">this</span>.specs) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> GenericAndJson.jsonToObject(<span class="built_in">this</span>.specs, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;Spec&gt;&gt;() &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSpecs</span><span class="params">(List&lt;Spec&gt; specs)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (specs.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.specs = GenericAndJson.objectToJson(specs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.haruharu.top">Nemesis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.haruharu.top/articles/uncategorized/Dev/Spring/spring-data/spring_data_jpa/">https://blog.haruharu.top/articles/uncategorized/Dev/Spring/spring-data/spring_data_jpa/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.haruharu.top" target="_blank">Nemesis</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/articles/uncategorized/Dev/language/Java/java-library/jackson-databind/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/articles/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/Dev/design-patterns/%E5%88%9B%E5%BB%BA%E5%9E%8B/%E6%9E%84%E5%BB%BA%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="构建器模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">构建器模式</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Nemesis</div><div class="author-info__description">浙江外国语学院大四老人 <br/> Talk is cheap. Show me the code.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Data-JPA"><span class="toc-number">1.</span> <span class="toc-text">Spring Data JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Model"><span class="toc-number">1.2.1.</span> <span class="toc-text">Model</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E6%9F%A5"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">审查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DAO"><span class="toc-number">1.2.2.</span> <span class="toc-text">DAO</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AA%E6%95%B4%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">未整理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#entity-%E5%AE%9E%E4%BD%93%E5%B1%82"><span class="toc-number">2.0.1.</span> <span class="toc-text">entity 实体层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IDEA-%E5%AE%9E%E4%BD%93%E5%AF%BC%E5%87%BA"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">IDEA 实体导出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">双向一对多</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="toc-number">2.0.1.3.</span> <span class="toc-text">双向多对多</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VO-%E5%B1%82"><span class="toc-number">2.0.1.4.</span> <span class="toc-text">VO 层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B0%81%E8%A3%85%EF%BC%9A%E6%8B%B7%E8%B4%9D%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">2.0.1.4.1.</span> <span class="toc-text">简单封装：拷贝对象的几种方法</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81%E4%B8%80%E4%B8%AA%E4%B8%AAget%E5%86%8Dset"><span class="toc-number">2.0.1.4.1.1.</span> <span class="toc-text">1、一个个get再set</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8spring%E7%9A%84BeanUtils-%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="toc-number">2.0.1.4.1.2.</span> <span class="toc-text">2、使用spring的BeanUtils 浅拷贝</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8-DozerBeanMapper-%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%88dozer-%E6%8E%A8%E5%9C%9F%E6%9C%BA%EF%BC%89"><span class="toc-number">2.0.1.4.1.3.</span> <span class="toc-text">3、使用 DozerBeanMapper 深拷贝（dozer: 推土机）</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%B1%BB%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">2.0.1.4.2.</span> <span class="toc-text">泛型类的封装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7VO%E6%A1%88%E4%BE%8B"><span class="toc-number">2.0.1.4.3.</span> <span class="toc-text">高级VO案例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Repository-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">Repository 持久层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E6%96%B9%E6%B3%95-JPA%E6%8C%81%E4%B9%85%E5%8C%96%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.1.1.</span> <span class="toc-text">命名方法 JPA持久化接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JPQL"><span class="toc-number">2.1.2.</span> <span class="toc-text">JPQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IDEA-%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">IDEA 小技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E-Optional"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">返回 Optional</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5"><span class="toc-number">2.1.3.</span> <span class="toc-text">分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%AF%B9%E8%B1%A1Pageable"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">分页对象Pageable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E6%9D%A1%E4%BB%B6%E7%9A%84SQL%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">带条件的SQL分页查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.4.</span> <span class="toc-text">自动配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">分页操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%8F%82%E6%95%B0%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.1.</span> <span class="toc-text">分页参数转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E7%BB%93%E6%9E%9C%E7%9A%84%E5%B0%81%E8%A3%85VO"><span class="toc-number">2.2.2.</span> <span class="toc-text">分页结果的封装VO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E7%BB%93%E6%9E%9CPage%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">分页结果Page&lt;T&gt;对象的方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AEPage%E4%B8%BAVO-Paging"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">封装分页查询后的数据Page&lt;T&gt;为VO(Paging)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E5%90%88Dozer%E5%AE%9E%E7%8E%B0%E6%89%A9%E5%B1%95Page-Paging-%E5%AF%B9%E8%B1%A1%EF%BC%88%E6%B3%9B%E5%9E%8B%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%EF%BC%89"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">配合Dozer实现扩展Page&lt;T&gt;(Paging)对象（泛型类的继承）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E8%BF%87%E7%A8%8B%EF%BC%88%E9%99%84Controller%E4%BB%A3%E7%A0%81%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">重构过程（附Controller代码）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3SKU%E7%9A%84%E8%A7%84%E6%A0%BC%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.</span> <span class="toc-text">详解SKU的规格设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%B3%9B%E5%9E%8BConverter"><span class="toc-number">2.4.</span> <span class="toc-text">通用泛型Converter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF"><span class="toc-number">2.4.1.</span> <span class="toc-text">场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapper%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.2.</span> <span class="toc-text">mapper序列化器方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BD%93JSON%E5%88%B0Map%E7%9A%84%E6%98%A0%E5%B0%84AttributeConverter"><span class="toc-number">2.4.3.</span> <span class="toc-text">单体JSON到Map的映射AttributeConverter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8BJSON%E4%B8%8EList%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-number">2.4.4.</span> <span class="toc-text">数组类型JSON与List的映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88Java%E7%B1%BB%E7%9A%84%E5%86%85%E8%81%9A%E6%80%A7%E3%80%81%E6%96%B9%E6%B3%95%E5%A4%96%E7%BD%AE%E9%97%AE%E9%A2%98"><span class="toc-number">2.4.5.</span> <span class="toc-text">谈Java类的内聚性、方法外置问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93Json%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.4.6.</span> <span class="toc-text">通用泛型类对数据库Json的序列化与反序列化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/small-language/Dev/language/small-language/YAML1.2/" title="YAML">YAML</a><time datetime="2024-04-19T16:00:00.000Z" title="发表于 2024-04-20 00:00:00">2024-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6/Web%E4%B8%AD%E9%97%B4%E4%BB%B6/Dev/%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6/Web%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/" title="Nginx"><img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_25_08_26_56.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx"/></a><div class="content"><a class="title" href="/articles/%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6/Web%E4%B8%AD%E9%97%B4%E4%BB%B6/Dev/%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6/Web%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/" title="Nginx">Nginx</a><time datetime="2024-03-17T16:00:00.000Z" title="发表于 2024-03-18 00:00:00">2024-03-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/Dev/design-patterns/%E7%BB%93%E6%9E%84%E5%9E%8B/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" title="桥接模式"><img src="https://refactoringguru.cn/images/patterns/diagrams/bridge/structure-zh.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="桥接模式"/></a><div class="content"><a class="title" href="/articles/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/Dev/design-patterns/%E7%BB%93%E6%9E%84%E5%9E%8B/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" title="桥接模式">桥接模式</a><time datetime="2024-03-12T16:00:00.000Z" title="发表于 2024-03-13 00:00:00">2024-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/Dev/design-patterns/%E5%88%9B%E5%BB%BA%E5%9E%8B/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" title="抽象工厂模式"><img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2024_0308_133937.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="抽象工厂模式"/></a><div class="content"><a class="title" href="/articles/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/Dev/design-patterns/%E5%88%9B%E5%BB%BA%E5%9E%8B/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" title="抽象工厂模式">抽象工厂模式</a><time datetime="2024-03-07T16:00:00.000Z" title="发表于 2024-03-08 00:00:00">2024-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/ORM%E6%A1%86%E6%9E%B6/Dev/ORM%E6%A1%86%E6%9E%B6/MyBatis/" title="Mybatis"><img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_21_14_50.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis"/></a><div class="content"><a class="title" href="/articles/ORM%E6%A1%86%E6%9E%B6/Dev/ORM%E6%A1%86%E6%9E%B6/MyBatis/" title="Mybatis">Mybatis</a><time datetime="2024-03-05T16:00:00.000Z" title="发表于 2024-03-06 00:00:00">2024-03-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Nemesis</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>