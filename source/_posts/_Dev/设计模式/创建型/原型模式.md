---
title: 原型模式
date: 2023-09-15
update: 2023-09-15
tag:
categories:
  - 原型模式
  - 创建型
keywords: 设计模式,原型模式
description: 关于设计模式中的原型方法模式
top_img:
cover: https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_18_18_57.png" alt="image-20230918185709946
---



# Prototype Pattern

## 意图

支持克隆的对象即为原型

原型模式是一种创建型设计模式，提供了 `clone()` 方法使你能够克隆已有对象，而又无需依赖它们所属的具体类(不用直接new)



## 结构

<img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting2/img/2023_09_18_18_57.png" alt="image-20230918185709946" style="zoom: 55%;" />

<center>基本实现</center>

1. **原型**(Prototype) 接口将对克隆方法进行声明。在绝大多数情况下，其中只会有一个 `clone()`克隆的方法。
2. **具体原型**(Concrete Prototype) 类将实现克隆方法。 除了将原始对象的数据复制到克隆体中之外，该方法有时还需处理克隆过程中的极端情况，例如克隆关联对象和梳理递归依赖等等。
3. **客户端**(Client) 可以复制实现了原型接口的任何对象。

<img src="https://cdn.jsdelivr.net/gh/ChenXiangcheng1/image-hosting1/img/2023_09_18_18_41.png" alt="image-20230918184138815" style="zoom: 67%;" />

<center>原型注册表</center>

1. **原型注册表**(Prototype Registry) 提供了一种访问常用原型的简单方法， 其中存储了一系列可供随时复制的预生成对象。 最简单的注册表原型是一个 `名称 → 原型`的哈希表。 



## 应用场景

* 当需要拷贝一些对象，同时又希望代码不依赖这些需要拷贝的对象所属的具体的类，可以使用原型模式

* 当需要创建一个只有属性差异的对象时，可以使用原型模式来拷贝一个已有对象，再根据需要修改其中的属性。



## 实现方式

1. 创建**原型接口**，并在其中声明 `clone()`方法。 或者添加 `clone()` 方法到存在类层次结构的所有类。
2. **原型类**必须定义一个以该类对象为参数的替代构造函数。 构造函数必须拷贝对象中所有成员变量值到新建实例中(支持浅拷贝或深拷贝)。 如果你需要修改子类， 则必须调用父类构造函数， 让父类处理其私有成员变量的克隆。

```java
prototype(c1 obj) {
    super(obj);
    this.a = obj.a;
}
```

3. 克隆方法通常只有一行代码： 使用原型的构造函数  `new` 运算符。 
   注意， 每个类都必须显式重写克隆方法并使用自身类名调用 `new` 运算符。 否则，克隆方法可能会生成父类的对象。

4. 你还可以创建一个中心化**原型注册表**，用于存储常用原型。
   你可以新建一个工厂类来实现注册表，或者在原型基类中添加一个获取原型的静态方法。该方法必须能够根据客户端代码设定的条件进行搜索。搜索条件可以是简单的字符串，或者是一组复杂的搜索参数。找到合适的原型后，注册表应对原型进行克隆，并将复制生成的对象返回给客户端。

5. 最后还要将对子类构造函数的直接调用替换为对原型注册表工厂方法的调用。



## 识别方法

工厂方法可通过构建方法来识别，它会创建具体类的对象，但以抽象类型或接口的形式返回这些对象。



## 我的评价

缺点：克隆包含循环引用的复杂对象可能会非常麻烦，不如直接new



## 示例1

Cloneable 接口就是原型接口

[Java笔记#对象的浅拷贝和深拷贝](../../Java/类库APIs/LiteAPIs.md#对象的浅拷贝和深拷贝)



## 示例2

[Spring IOC笔记#](../../Spring/spring-core/核心/spring_ioc.md#原型模式)
